# synthsniff 🔍✍️

A super‑light CLI that sniffs text files for AI‑ish markers: smart quotes, long dashes, `---` markdown rules, non‑breaking spaces and more.
Perfect for pre‑commit hooks or CI to flag autogenerated copy.

## Quick start

```bash
# build and install the latest binary
go install github.com/JoobyPM/synthsniff/cmd/sniff4ai@latest

# scan the current directory (recursively)
sniff4ai .

# respect every .gitignore while scanning
sniff4ai --use-gitignore .

# apply a custom ignore file everywhere
sniff4ai --ignore-file my.ignore src/
```

Sample output:

```
🚨 docs/faq.md (score 6)
```

A clean tree gets a happy tick:

```
✅ No AI smell detected in 57 file(s)
```

## Flags you will actually use

| flag                                 | purpose                                                             |
| ------------------------------------ | ------------------------------------------------------------------- |
| `-v`                                 | show counts per rule for **smelly** files                           |
| `-vv`                                | show **all** files with rule breakdown                              |
| `-vvv`                               | show every file, rule field and the list of loaded ignore files     |
| `-json`                              | machine‑readable output (pipe into `jq`)                            |
| `-ci`                                | exit 1 if any file crosses the threshold (default 3)                |
| `-t N` or env `SYNTHSNIFF_THRESHOLD` | change threshold                                                    |
| `-dict rules.yml`                    | merge your own patterns and weights                                 |
| `-max BYTES`                         | skip files larger than this (default 10 MiB)                        |
| `-j N`                               | run N workers in parallel (default: number of CPUs, capped at 4)    |
| `--use-gitignore`                    | apply every `.gitignore` it meets to child dirs                     |
| `--ignore-file path`                 | use a standalone ignore file everywhere (same syntax as .gitignore) |

## Git ignore support

When `--use-gitignore` is active, synthsniff walks up the directory tree and loads every `.gitignore` it encounters. Patterns cascade to sub‑directories, and deeper rules override parent ones. Add `--ignore-file` to point at a separate ignore list if your project does not use Git.

Enable `-vvv` to print a summary of all ignore files that were applied after the scan results.

## Custom rules (fine‑tuning)

Each rule supports extra knobs; all are optional.

```yaml
- name: MermaidFence                # short ID shown in -vv and -vvv
  pattern: "```mermaid"            # matcher (required)
  weight: 3                         # score multiplier (required)

  minCount: 2                       # require >= 2 hits before it scores
  minPercent: 1.0                   # or >= 1 percent of tokens or bytes
  description: Markdown mermaid diagram fence
  exts: [md, markdown]              # restrict to these extensions
```

### Minimal example

```yaml
# rules.yml
- name: IdeographicSpace
  pattern: "\u3000"   # full‑width space
  weight: 2
```

```bash
sniff4ai -dict rules.yml src/
```

## CI snippet

```bash
sniff4ai -ci -json ./src | jq '.[] | select(.smelly)'
```

If any smelly file appears, the command exits with status 1. Perfect for GitHub Actions or other pipelines.

Licensed under **MIT**.  
Contributions welcome; please stick to the Uber Go Style Guide.

